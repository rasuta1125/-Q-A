# CSVインポート機能（重複検出・選抜機能付き）使い方ガイド

## 📋 概要

LINE Official Accountからエクスポートした会話履歴CSVを自動解析して、有用なQ&Aデータのみを抽出・登録できる機能です。

## ✨ 主な機能

### 1. **自動形式検出**
- LINE Official Account形式を自動検出
- 通常のCSV形式にも対応

### 2. **インテリジェントQ&A抽出**
- 顧客の質問と店側の回答ペアを自動抽出
- 埋め込まれたFAQ（Q.〜 A.〜形式）も自動検出
- 個人情報（名前、電話番号、メールアドレス）を自動除外
- 予約フォームや営業メッセージを自動除外
- システムメッセージ（写真を送信しました等）を自動除外

### 3. **重複検出機能**
- 質問の類似度を自動判定（85%以上類似で重複とみなす）
- 完全一致だけでなく、部分一致も検出
- 重複グループごとにまとめて表示

### 4. **選抜機能**
- 重複したQ&Aから最適なバージョンを選択可能
- プレビューで内容を確認してから登録
- 最終的なインポート件数を確認

## 🚀 使用方法

### ステップ1: LINE Official AccountからCSVをエクスポート

1. **LINE Official Account Manager**にログイン
2. **「チャット」→「トーク履歴をダウンロード」**を選択
3. 期間を指定してCSVファイルをダウンロード

### ステップ2: CSVファイルをアップロード

1. **Q&A管理画面（`/admin`）**にアクセス
2. **「CSVインポート」ボタン**をクリック
3. エクスポートしたCSVファイルを選択
4. **「CSVを読み込んで重複チェック」**をクリック

### ステップ3: 重複を確認・選抜

1. **重複グループが表示される**
   - 類似した質問がグループ化されて表示されます
   - デフォルトで最初のバージョンが選択されています

2. **採用するバージョンを選択**
   - 各重複グループでラジオボタンをクリック
   - より詳細な回答や、より分かりやすい質問文を選択

3. **ユニークなQ&Aを確認**
   - 重複のないQ&Aは自動的に採用されます
   - リストで内容を確認できます

4. **最終件数を確認**
   - 画面下部に「選択した内容でインポート（○件）」と表示されます

### ステップ4: インポート実行

1. **「選択した内容でインポート」ボタン**をクリック
2. 確認ダイアログで「OK」
3. インポート完了！

## 📊 LINEエクスポートデータから抽出される内容

### ✅ 抽出されるQ&A

1. **埋め込まれたFAQ**
   ```
   Q.定休日はいつになりますか？
   A.月曜日火曜日になります
   ```
   → 優先度「高」で登録

2. **顧客との実際のやり取り**
   ```
   User: 平日割引はありますか？
   Account: はい、平日は¥3,000割引です
   ```
   → 優先度「中」で登録

### ❌ 除外される内容

- 個人名（〜さん、〜様で始まるメッセージ）
- 電話番号、メールアドレス
- 予約フォーム（「お子様の名前:」等）
- 営業・広告メッセージ
- システムメッセージ（「写真を送信しました」等）

## 🎯 重複検出の仕組み

### 類似度判定基準

1. **完全一致**
   - 正規化後（小文字化、空白・句読点除去）が完全に一致

2. **部分一致（80%以上）**
   - 一方の質問が他方を含み、80%以上の長さ比率

3. **編集距離ベース（85%以上類似）**
   - Levenshtein距離を使用した類似度計算
   - 85%以上の類似度で重複とみなす

### 例

以下は重複として検出されます：
- 「平日割引はありますか?」
- 「平日は割引ありますか?」
- 「平日割引ある？」

## 📝 カテゴリの自動推測

質問内容から以下のカテゴリを自動で推測します：

- **料金**: 料金、価格、金額、いくら、値段
- **予約**: 予約、予約方法、申込
- **撮影時間**: 時間、何時、所要時間
- **定休日**: 定休日、休み、営業日
- **衣装**: 衣装、着物、ドレス、持ち込み
- **七五三**: 七五三、753、着付け
- **撮影内容**: 撮影、メイン、兄弟、家族
- **データ**: データ、納品、写真
- **その他**: 上記に当てはまらないもの

## 🔧 通常のCSV形式でもインポート可能

LINE形式以外の通常のCSVファイルも対応しています：

### CSV形式
```csv
カテゴリ,質問,回答,キーワード
料金,平日割引はありますか?,はい、平日は¥3,000割引です,平日割引,料金
撮影時間,何時から撮影できますか?,10時から可能です,営業時間,時間
```

## ⚠️ 注意事項

1. **プライバシー保護**
   - 個人名などのプライバシー情報は自動的に除外されます
   - ただし、念のため登録前にプレビューで確認してください

2. **重複チェック**
   - 既存のQ&Aとの重複チェックは行われません
   - 同じ内容を複数回インポートしないよう注意してください

3. **カテゴリ調整**
   - 自動推測されたカテゴリは登録後に編集画面で調整可能です

4. **ファイルサイズ**
   - 大きなファイル（1000行以上）の場合、処理に時間がかかる場合があります

## 💡 ヒント

### より良い結果を得るために

1. **期間を分けてエクスポート**
   - 数ヶ月分ずつエクスポートして段階的にインポート

2. **重複選択のコツ**
   - より具体的で詳細な回答を優先
   - 最新の情報が含まれているものを選択

3. **登録後の確認**
   - インポート後はQ&A一覧で内容を確認
   - 必要に応じて編集や削除

## 📚 関連ドキュメント

- **通常の一括インポート**: `BULK_IMPORT_GUIDE.md`
- **システム全体**: `README.md`

## 🆘 トラブルシューティング

### CSVが読み込めない
→ ファイル形式がUTF-8であることを確認
→ LINE Official Accountからの正規エクスポートデータか確認

### Q&Aが抽出されない
→ LINE形式のCSVは特殊なフォーマットです
→ 「送信者タイプ,送信者名,送信日,送信時刻,内容」というヘッダーがあるか確認

### 重複検出が多すぎる/少なすぎる
→ 類似度閾値は85%に設定されています
→ 必要に応じて開発者に調整を依頼

---

**完成！LINE会話履歴から簡単にQ&Aデータベースを構築できます** 🎉
